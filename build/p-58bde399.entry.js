import{r as t,h as e,H as i}from"./p-8Q-8j7RM.js";import{b as n,i as o}from"./p-B6mi5IKT.js";import{i as l}from"./p-r8LcZM4F.js";import{i as s}from"./p-n-TtRdRj.js";const a=":host,\ngeov-yasgui-map-circles {\n  container-type: size;\n  display: block;\n  width: 100%;\n  height: 100%;\n}\n\n.geov-map-circles-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n.geov-map-circles-container .maplibregl-popup-content {\n  overflow-y: auto;\n  max-height: 210px;\n  padding: 0;\n}\n\n\ngeov-yasgui-map-circles ion-list {\n  overflow-y: auto;\n}\n\n.legend {\n  position: absolute;\n  z-index: 1;\n  max-width: 300px;\n  margin: 0;\n  top: 10px;\n  left: 10px;\n  max-height: calc(100% - 20px);\n  display: flex;\n  flex-direction: column;\n}\n\n\n.legend .collapse-button {\n  position: absolute;\n  margin: 0;\n  top: 4px;\n  left: 0;\n  z-index: 9999;\n}\n\n.legend.collapsed {\n  width: 46px;\n  height: 36px;\n\n}\n\n\n@container (width >=700px) {\n  .legend {\n    max-width: 300px;\n  }\n}\n\n#display-query {\n  position: absolute;\n  z-index: 1;\n  right: 0;\n}\n\n.yasgui .hidden {\n  display: none !important;\n}\n";function r(t,e){return{type:"FeatureCollection",features:t.map((t=>{var i,n,o,l,s,a,r;return{type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(t["long"].value),parseFloat(t["lat"].value)]},properties:{label:(i=t["label"])===null||i===void 0?void 0:i.value,radius:Math.round((parseFloat((n=t["radius"])===null||n===void 0?void 0:n.value)||0)*10)/10,number:parseInt((o=t["number"])===null||o===void 0?void 0:o.value),type:((l=t["type"])===null||l===void 0?void 0:l.value)||"none",typeindex:e.indexOf(((s=t["type"])===null||s===void 0?void 0:s.value)||"none"),link:(a=t["link"])===null||a===void 0?void 0:a.value,children:(r=t["children"])===null||r===void 0?void 0:r.value}}}))}}const c=class{constructor(e){t(this,e);this.data=[{radius:{value:"80.2345",type:"literal"},number:{value:"0",type:"literal"},type:{value:"default",type:"literal"},long:{value:"8.2318",type:"literal"},lat:{value:"46.7985",type:"literal"},label:{value:"default",type:"literal"},link:{value:"default",type:"literal"}}];this.radiusMin=8;this.radiusMax=20;this.maxZoom=10;this.colorScale=["#a6cee3","#1f78b4","#b2df8a","#33a02c"];this.ledgendExpanded=true;this.disableScrollZoom=false;this.displayMapNavigationControls=false;this.labelIndices=[...new Set(this.data.map((t=>{var e;return((e=t["type"])===null||e===void 0?void 0:e.value)||"none"})))]}async componentDidLoad(){if(!s()){const t=this.data.filter((t=>{var e,i,n,o,l,s,a,r,c;if(Object.hasOwn(t,"radius")&&(isNaN((e=t["radius"])===null||e===void 0?void 0:e.value)||Number((i=t["radius"])===null||i===void 0?void 0:i.value)===0))return true;if(Object.hasOwn(t,"number")&&isNaN((n=t["number"])===null||n===void 0?void 0:n.value))return true;return Number((o=t["long"])===null||o===void 0?void 0:o.value)<-180||Number((l=t["long"])===null||l===void 0?void 0:l.value)>180||Number((s=t["lat"])===null||s===void 0?void 0:s.value)<-90||Number((a=t["lat"])===null||a===void 0?void 0:a.value)>90||isNaN((r=t["long"])===null||r===void 0?void 0:r.value)||isNaN((c=t["lat"])===null||c===void 0?void 0:c.value)}));if(!(t===null||t===void 0?void 0:t.length)){const t=await l();const e=new t.Map({container:this.mapContainerEl,style:{version:8,sources:{osm:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/rastertiles/light_nolabels/{z}/{x}/{y}{ratio}.png","https://b.basemaps.cartocdn.com/rastertiles/light_nolabels/{z}/{x}/{y}{ratio}.png","https://c.basemaps.cartocdn.com/rastertiles/light_nolabels/{z}/{x}/{y}{ratio}.png"],tileSize:256,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',maxzoom:19}},layers:[{id:"osm",type:"raster",source:"osm"}],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"},zoom:6});let i=Number.MAX_VALUE;let n=Number.MIN_VALUE;let o=Number.MAX_VALUE;let s=Number.MIN_VALUE;this.data.forEach((t=>{const e=parseFloat(t["long"].value);const l=parseFloat(t["lat"].value);i=Math.min(i,e);n=Math.max(n,e);o=Math.min(o,l);s=Math.max(s,l)}));const a=[[i,o],[n,s]];e.fitBounds(a,{padding:50,maxZoom:this.maxZoom,animate:false});if(this.disableScrollZoom){e.scrollZoom.disable()}if(this.displayMapNavigationControls){e.addControl(new t.NavigationControl)}e.on("load",(()=>{e.addSource("places",{type:"geojson",data:r(this.data,this.labelIndices)});const i=Math.max(...this.data.map((t=>{var e;return parseInt((e=t["radius"])===null||e===void 0?void 0:e.value)||0})));let n;if(this.colorScale.length<2){n=this.colorScale[0]}else{n=["step",["get","typeindex"]];for(let t=0;t<this.colorScale.length;t++){if(t>0)n.push(t);n.push(this.colorScale[t])}}e.addLayer({id:"circles",type:"circle",source:"places",paint:{"circle-color":n,"circle-radius":i?["interpolate",["linear"],["get","radius"],0,this.radiusMin,i,this.radiusMax]:this.radiusMin,"circle-opacity":.8}});const o=i=>{const n=i.features[0].geometry.coordinates;const o=i.features.map((t=>{let e=[];try{e=JSON.parse(t.properties.children)}catch(t){}const i={label:t.properties.label,url:t.properties.link,suffix:t.properties.number,items:e.map((t=>({label:t===null||t===void 0?void 0:t.label,url:t===null||t===void 0?void 0:t.url})))};return i}));const l=document.createElement("geov-map-circles-popup");l.items=o;(new t.Popup).setLngLat(n).setDOMContent(l).setMaxWidth("340px").addTo(e)};e.on("click","circles",o);e.on("mouseenter","circles",(()=>{e.getCanvas().style.cursor="pointer"}));e.on("mouseleave","circles",(()=>{e.getCanvas().style.cursor=""}))}))}}}render(){return e(i,null,e("ion-card",{class:`legend ${this.ledgendExpanded?"":"collapsed"}`},e("ion-card-header",null,e("ion-button",{size:"small",class:"collapse-button",fill:"clear",onClick:()=>this.ledgendExpanded=!this.ledgendExpanded},e("ion-icon",{icon:this.ledgendExpanded?n:o,slot:"icon-only"}))),e("ion-list",null,this.labelIndices.map(((t,i)=>e("ion-item",{lines:i===this.labelIndices.length-1?"none":"full"},e("svg",{slot:"start",height:"1rem",width:"1rem"},e("circle",{cx:"50%",cy:"50%",r:"50%",fill:this.colorScale[i%this.colorScale.length]})),e("ion-label",{class:"ion-text-wrap"},t)))))),e("div",{class:"geov-map-circles-container",ref:t=>this.mapContainerEl=t}))}};c.style=a;export{c as geov_yasgui_map_circles};
//# sourceMappingURL=p-58bde399.entry.js.map